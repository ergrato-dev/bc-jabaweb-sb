#!/bin/sh
# ═══════════════════════════════════════════════════════════════════════════
# Maven Wrapper Script (Unix/Linux/macOS)
# ═══════════════════════════════════════════════════════════════════════════
#
# Este script descarga y ejecuta la versión correcta de Maven automáticamente.
# Uso: ./mvnw clean package
#
# ═══════════════════════════════════════════════════════════════════════════

# Configuración
MAVEN_PROJECTBASEDIR="${MAVEN_BASEDIR:-$(cd "$(dirname "$0")" && pwd)}"
MAVEN_WRAPPER_JAR="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.jar"
MAVEN_WRAPPER_PROPERTIES="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.properties"

# Si no existe el wrapper jar, lo descargamos
if [ ! -f "$MAVEN_WRAPPER_JAR" ]; then
    if [ -f "$MAVEN_WRAPPER_PROPERTIES" ]; then
        WRAPPER_URL=$(grep wrapperUrl "$MAVEN_WRAPPER_PROPERTIES" | cut -d'=' -f2)
        echo "Downloading Maven Wrapper from $WRAPPER_URL"
        if command -v wget > /dev/null; then
            wget -O "$MAVEN_WRAPPER_JAR" "$WRAPPER_URL"
        elif command -v curl > /dev/null; then
            curl -o "$MAVEN_WRAPPER_JAR" "$WRAPPER_URL"
        else
            echo "Error: wget or curl is required to download Maven Wrapper"
            exit 1
        fi
    fi
fi

# Ejecutar Maven
exec java \
    -Dmaven.multiModuleProjectDirectory="$MAVEN_PROJECTBASEDIR" \
    -Dmaven.home="$MAVEN_PROJECTBASEDIR/.mvn" \
    -classpath "$MAVEN_WRAPPER_JAR" \
    org.apache.maven.wrapper.MavenWrapperMain "$@"
