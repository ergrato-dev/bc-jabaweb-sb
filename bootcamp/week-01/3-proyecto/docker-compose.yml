# ════════════════════════════════════════════════════════════════════════════
# Bootcamp Java Web - Semana 01
# EJERCICIO: Completa este archivo docker-compose.yml
# ════════════════════════════════════════════════════════════════════════════
#
# OBJETIVO: Configurar un entorno de desarrollo Java con Docker Compose
#
# INSTRUCCIONES:
# 1. Completa cada TODO siguiendo las pistas
# 2. Referencia: https://docs.docker.com/compose/compose-file/
# 3. Prueba con: docker compose config (valida sintaxis)
# 4. Ejecuta con: docker compose up dev
#
# ESTRUCTURA DE UN SERVICIO:
#   nombre_servicio:
#     image: imagen:tag           # Imagen a usar
#     container_name: nombre      # Nombre del contenedor
#     working_dir: /path          # Directorio de trabajo
#     volumes:                    # Montaje de directorios
#       - ./local:/contenedor
#     environment:                # Variables de entorno
#       - VAR=valor
#     env_file:                   # Archivo con variables
#       - .env
#     ports:                      # Mapeo de puertos
#       - "8080:8080"
#     stdin_open: true            # Equivale a -i (interactivo)
#     tty: true                   # Equivale a -t (terminal)
#     command: comando            # Comando a ejecutar
#
# ════════════════════════════════════════════════════════════════════════════

services:
  # -------------------------------------------------------------------------
  # SERVICIO 1: Entorno de desarrollo interactivo
  # -------------------------------------------------------------------------
  # Este servicio te permite entrar al contenedor y trabajar interactivamente
  # Uso: docker compose run --rm dev
  # -------------------------------------------------------------------------
  dev:
    # TODO 1: Especifica la imagen de Java
    # Usa: eclipse-temurin:21-jdk
    image: # COMPLETA AQUÍ
    
    # TODO 2: Asigna un nombre al contenedor
    # Sugerencia: week01-dev
    container_name: # COMPLETA AQUÍ
    
    # TODO 3: Establece el directorio de trabajo
    # Usa: /app
    working_dir: # COMPLETA AQUÍ
    
    # TODO 4: Monta los volúmenes necesarios
    # Monta estas carpetas locales en el contenedor:
    #   - ./src  →  /app/src   (código fuente)
    #   - ./out  →  /app/out   (archivos compilados)
    # Sintaxis: - ./carpeta_local:/carpeta_contenedor
    volumes:
      # COMPLETA AQUÍ (dos líneas)
    
    # TODO 5: Carga las variables desde archivo .env
    # Sintaxis: env_file:
    #             - .env
    # COMPLETA AQUÍ
    
    # TODO 6: Habilita modo interactivo
    # Necesitas estas dos opciones para poder escribir en el contenedor:
    #   stdin_open: true
    #   tty: true
    # COMPLETA AQUÍ
    
    # TODO 7: Define el comando por defecto
    # Usa: bash (para tener un shell interactivo)
    command: # COMPLETA AQUÍ

  # -------------------------------------------------------------------------
  # SERVICIO 2: Compilar y ejecutar (DESAFÍO)
  # -------------------------------------------------------------------------
  # Este servicio compila el código Java y lo ejecuta automáticamente
  # Uso: docker compose up app
  # -------------------------------------------------------------------------
  app:
    # TODO 8: Configura este servicio para compilar y ejecutar
    # 
    # Necesitas:
    #   - image: eclipse-temurin:21-jdk-alpine (más ligera)
    #   - container_name: week01-app
    #   - working_dir: /app
    #   - volumes: montar src (solo lectura con :ro) y out
    #   - env_file: cargar .env
    #   - command: un comando que compile y ejecute
    #
    # Para el comando, puedes usar:
    #   command: sh -c "javac src/*.java -d out && java -cp out Main"
    #
    # Esto hace:
    #   1. javac src/*.java -d out → compila todos los .java
    #   2. && → si el anterior tuvo éxito, ejecuta el siguiente
    #   3. java -cp out Main → ejecuta la clase Main
    #
    # COMPLETA TODO EL SERVICIO AQUÍ:
    

# ════════════════════════════════════════════════════════════════════════════
# VERIFICACIÓN:
#
# 1. Valida la sintaxis:
#    docker compose config
#
# 2. Prueba el servicio dev:
#    docker compose run --rm dev
#    (dentro del contenedor: javac src/Main.java -d out && java -cp out Main)
#
# 3. Prueba el servicio app:
#    docker compose up app
#
# ════════════════════════════════════════════════════════════════════════════
#
# DESAFÍO EXTRA:
# Agrega un tercer servicio llamado "compile" que SOLO compile el código
# sin ejecutarlo. Usa profiles para que no se ejecute por defecto:
#   profiles:
#     - tools
# Ejecución: docker compose --profile tools run --rm compile
#
# ════════════════════════════════════════════════════════════════════════════
