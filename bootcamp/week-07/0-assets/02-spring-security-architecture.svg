<svg viewBox="0 0 900 550" xmlns="http://www.w3.org/2000/svg">
    <rect width="900" height="550" fill="#1e1e1e" />

    <text x="450" y="35" fill="#f0f0f0" font-family="Segoe UI, sans-serif" font-size="20"
        font-weight="bold" text-anchor="middle">Arquitectura de Spring Security</text>

    <!-- HTTP Request -->
    <rect x="30" y="100" width="120" height="60" rx="8" fill="#2196f3" />
    <text x="90" y="125" fill="#fff" font-family="Segoe UI, sans-serif" font-size="12"
        font-weight="bold" text-anchor="middle">HTTP Request</text>
    <text x="90" y="145" fill="#e3f2fd" font-family="Segoe UI, sans-serif" font-size="10"
        text-anchor="middle">GET /api/users</text>

    <!-- Arrow -->
    <path d="M150 130 L180 130" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)" />

    <!-- Security Filter Chain -->
    <rect x="190" y="60" width="500" height="200" rx="10" fill="#2d2d2d" stroke="#ff9800"
        stroke-width="2" />
    <text x="440" y="85" fill="#ff9800" font-family="Segoe UI, sans-serif" font-size="14"
        font-weight="bold" text-anchor="middle">SecurityFilterChain</text>

    <!-- Filters -->
    <rect x="210" y="100" width="100" height="50" rx="5" fill="#424242" />
    <text x="260" y="120" fill="#4fc3f7" font-family="Segoe UI, sans-serif" font-size="10"
        text-anchor="middle">CORS</text>
    <text x="260" y="135" fill="#888" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">Filter</text>

    <path d="M310 125 L330 125" stroke="#666" stroke-width="1" marker-end="url(#arrowGray)" />

    <rect x="340" y="100" width="100" height="50" rx="5" fill="#424242" />
    <text x="390" y="120" fill="#4fc3f7" font-family="Segoe UI, sans-serif" font-size="10"
        text-anchor="middle">CSRF</text>
    <text x="390" y="135" fill="#888" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">Filter</text>

    <path d="M440 125 L460 125" stroke="#666" stroke-width="1" marker-end="url(#arrowGray)" />

    <rect x="470" y="100" width="100" height="50" rx="5" fill="#1b5e20" stroke="#4caf50"
        stroke-width="2" />
    <text x="520" y="120" fill="#81c784" font-family="Segoe UI, sans-serif" font-size="10"
        text-anchor="middle">JWT Auth</text>
    <text x="520" y="135" fill="#a5d6a7" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">Filter ★</text>

    <path d="M570 125 L590 125" stroke="#666" stroke-width="1" marker-end="url(#arrowGray)" />

    <rect x="600" y="100" width="70" height="50" rx="5" fill="#424242" />
    <text x="635" y="120" fill="#4fc3f7" font-family="Segoe UI, sans-serif" font-size="10"
        text-anchor="middle">Auth</text>
    <text x="635" y="135" fill="#888" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">Filter</text>

    <!-- Security Context -->
    <rect x="210" y="170" width="230" height="70" rx="5" fill="#263238" />
    <text x="325" y="195" fill="#ffb74d" font-family="Segoe UI, sans-serif" font-size="12"
        font-weight="bold" text-anchor="middle">SecurityContext</text>
    <text x="325" y="215" fill="#888" font-family="Segoe UI, sans-serif" font-size="10"
        text-anchor="middle">Authentication object</text>
    <text x="325" y="230" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">Principal, Credentials, Authorities</text>

    <!-- Authorization -->
    <rect x="460" y="170" width="210" height="70" rx="5" fill="#263238" />
    <text x="565" y="195" fill="#ce93d8" font-family="Segoe UI, sans-serif" font-size="12"
        font-weight="bold" text-anchor="middle">Authorization</text>
    <text x="565" y="215" fill="#888" font-family="Segoe UI, sans-serif" font-size="10"
        text-anchor="middle">@PreAuthorize</text>
    <text x="565" y="230" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">hasRole('ADMIN')</text>

    <!-- Arrow to Controller -->
    <path d="M690 130 L720 130" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)" />

    <!-- Controller -->
    <rect x="730" y="100" width="140" height="60" rx="8" fill="#4caf50" />
    <text x="800" y="125" fill="#fff" font-family="Segoe UI, sans-serif" font-size="12"
        font-weight="bold" text-anchor="middle">@RestController</text>
    <text x="800" y="145" fill="#c8e6c9" font-family="Segoe UI, sans-serif" font-size="10"
        text-anchor="middle">Business Logic</text>

    <!-- Lower section - Components -->
    <text x="450" y="310" fill="#f0f0f0" font-family="Segoe UI, sans-serif" font-size="16"
        font-weight="bold" text-anchor="middle">Componentes Clave</text>

    <!-- UserDetailsService -->
    <rect x="50" y="340" width="180" height="90" rx="8" fill="#2d2d2d" stroke="#4fc3f7"
        stroke-width="1" />
    <text x="140" y="365" fill="#4fc3f7" font-family="Segoe UI, sans-serif" font-size="11"
        font-weight="bold" text-anchor="middle">UserDetailsService</text>
    <text x="140" y="385" fill="#888" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">loadUserByUsername()</text>
    <text x="140" y="405" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">Carga usuario de BD</text>
    <text x="140" y="420" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">→ UserDetails</text>

    <!-- PasswordEncoder -->
    <rect x="260" y="340" width="180" height="90" rx="8" fill="#2d2d2d" stroke="#81c784"
        stroke-width="1" />
    <text x="350" y="365" fill="#81c784" font-family="Segoe UI, sans-serif" font-size="11"
        font-weight="bold" text-anchor="middle">PasswordEncoder</text>
    <text x="350" y="385" fill="#888" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">BCryptPasswordEncoder</text>
    <text x="350" y="405" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">encode() - Hash password</text>
    <text x="350" y="420" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">matches() - Verificar</text>

    <!-- AuthenticationManager -->
    <rect x="470" y="340" width="180" height="90" rx="8" fill="#2d2d2d" stroke="#ffb74d"
        stroke-width="1" />
    <text x="560" y="365" fill="#ffb74d" font-family="Segoe UI, sans-serif" font-size="11"
        font-weight="bold" text-anchor="middle">AuthenticationManager</text>
    <text x="560" y="385" fill="#888" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">authenticate()</text>
    <text x="560" y="405" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">Coordina autenticación</text>
    <text x="560" y="420" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">→ Authentication</text>

    <!-- JwtService -->
    <rect x="680" y="340" width="180" height="90" rx="8" fill="#2d2d2d" stroke="#f48fb1"
        stroke-width="1" />
    <text x="770" y="365" fill="#f48fb1" font-family="Segoe UI, sans-serif" font-size="11"
        font-weight="bold" text-anchor="middle">JwtService (Custom)</text>
    <text x="770" y="385" fill="#888" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">generateToken()</text>
    <text x="770" y="405" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">validateToken()</text>
    <text x="770" y="420" fill="#666" font-family="Segoe UI, sans-serif" font-size="9"
        text-anchor="middle">extractUsername()</text>

    <!-- Legend -->
    <rect x="50" y="470" width="15" height="15" fill="#1b5e20" stroke="#4caf50" stroke-width="1" />
    <text x="75" y="482" fill="#888" font-family="Segoe UI, sans-serif" font-size="11">Filtro JWT
        personalizado (implementar)</text>

    <rect x="350" y="470" width="15" height="15" fill="#424242" />
    <text x="375" y="482" fill="#888" font-family="Segoe UI, sans-serif" font-size="11">Filtros de
        Spring Security (automáticos)</text>

    <defs>
        <marker id="arrowGray" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <path d="M0,0 L0,6 L9,3 z" fill="#666" />
        </marker>
    </defs>
</svg>
